# Source: https://github.com/Hats-Protocol/hats-zodiac

[Hats-Protocol](https://github.com/Hats-Protocol)/ **[hats-zodiac](https://github.com/Hats-Protocol/hats-zodiac)** Public

- [Notifications](https://github.com/login?return_to=%2FHats-Protocol%2Fhats-zodiac) You must be signed in to change notification settings
- [Fork\\
8](https://github.com/login?return_to=%2FHats-Protocol%2Fhats-zodiac)
- [Star\\
23](https://github.com/login?return_to=%2FHats-Protocol%2Fhats-zodiac)


Hats Protocol-enabled Zodiac contracts


### License

[LGPL-3.0 license](https://github.com/Hats-Protocol/hats-zodiac/blob/main/LICENSE)

[23\\
stars](https://github.com/Hats-Protocol/hats-zodiac/stargazers) [8\\
forks](https://github.com/Hats-Protocol/hats-zodiac/forks) [Branches](https://github.com/Hats-Protocol/hats-zodiac/branches) [Tags](https://github.com/Hats-Protocol/hats-zodiac/tags) [Activity](https://github.com/Hats-Protocol/hats-zodiac/activity)

[Star](https://github.com/login?return_to=%2FHats-Protocol%2Fhats-zodiac)

[Notifications](https://github.com/login?return_to=%2FHats-Protocol%2Fhats-zodiac) You must be signed in to change notification settings

# Hats-Protocol/hats-zodiac

main

[**11** Branches](https://github.com/Hats-Protocol/hats-zodiac/branches) [**4** Tags](https://github.com/Hats-Protocol/hats-zodiac/tags)

[Go to Branches page](https://github.com/Hats-Protocol/hats-zodiac/branches)[Go to Tags page](https://github.com/Hats-Protocol/hats-zodiac/tags)

Go to file

Code

Open more actions menu

## Folders and files

| Name | Name | Last commit message | Last commit date |
| --- | --- | --- | --- |
| ## Latest commit<br>[![spengrah](https://avatars.githubusercontent.com/u/13247381?v=4&size=40)](https://github.com/spengrah)[spengrah](https://github.com/Hats-Protocol/hats-zodiac/commits?author=spengrah)<br>[Merge pull request](https://github.com/Hats-Protocol/hats-zodiac/commit/2c0172e979e64f6f73647adc634a4622cba465ef) [#45](https://github.com/Hats-Protocol/hats-zodiac/pull/45) [from Hats-Protocol/v2](https://github.com/Hats-Protocol/hats-zodiac/commit/2c0172e979e64f6f73647adc634a4622cba465ef)<br>Open commit detailsfailure<br>Dec 18, 2024<br>[2c0172e](https://github.com/Hats-Protocol/hats-zodiac/commit/2c0172e979e64f6f73647adc634a4622cba465ef) · Dec 18, 2024<br>## History<br>[449 Commits](https://github.com/Hats-Protocol/hats-zodiac/commits/main/) <br>Open commit details<br>[View commit history for this file.](https://github.com/Hats-Protocol/hats-zodiac/commits/main/) |
| [.github/workflows](https://github.com/Hats-Protocol/hats-zodiac/tree/main/.github/workflows "This path skips through empty directories") | [.github/workflows](https://github.com/Hats-Protocol/hats-zodiac/tree/main/.github/workflows "This path skips through empty directories") | [improve ci performance](https://github.com/Hats-Protocol/hats-zodiac/commit/c539927b8d52a379ab83f802d0793f77c86cb523 "improve ci performance") | Dec 18, 2024 |
| [broadcast](https://github.com/Hats-Protocol/hats-zodiac/tree/main/broadcast "broadcast") | [broadcast](https://github.com/Hats-Protocol/hats-zodiac/tree/main/broadcast "broadcast") | [deploy beta 5 to gnosis chain](https://github.com/Hats-Protocol/hats-zodiac/commit/4377bddf16ac467e510a0036de948cf6530df714 "deploy beta 5 to gnosis chain") | Nov 15, 2022 |
| [docs](https://github.com/Hats-Protocol/hats-zodiac/tree/main/docs "docs") | [docs](https://github.com/Hats-Protocol/hats-zodiac/tree/main/docs "docs") | [add v2 audit report](https://github.com/Hats-Protocol/hats-zodiac/commit/19db39be3b9f0681e051cb003ba11474e56e7bc8 "add v2 audit report") | Dec 15, 2024 |
| [lib](https://github.com/Hats-Protocol/hats-zodiac/tree/main/lib "lib") | [lib](https://github.com/Hats-Protocol/hats-zodiac/tree/main/lib "lib") | [make HSG multicallable](https://github.com/Hats-Protocol/hats-zodiac/commit/df7e7b1dc510071878f2a21c5c1ffa4e71fcca3c "make HSG multicallable") | Oct 25, 2024 |
| [script](https://github.com/Hats-Protocol/hats-zodiac/tree/main/script "script") | [script](https://github.com/Hats-Protocol/hats-zodiac/tree/main/script "script") | [deploy v2](https://github.com/Hats-Protocol/hats-zodiac/commit/11428ff318cb111b38e9c53b852132f8e04ab71d "deploy v2") | Dec 18, 2024 |
| [src](https://github.com/Hats-Protocol/hats-zodiac/tree/main/src "src") | [src](https://github.com/Hats-Protocol/hats-zodiac/tree/main/src "src") | [add non-zero salt to safe deploy](https://github.com/Hats-Protocol/hats-zodiac/commit/c0193f51580e23e3136c13f083c991eee60233b1 "add non-zero salt to safe deploy") | Dec 16, 2024 |
| [test](https://github.com/Hats-Protocol/hats-zodiac/tree/main/test "test") | [test](https://github.com/Hats-Protocol/hats-zodiac/tree/main/test "test") | [add non-zero salt to safe deploy](https://github.com/Hats-Protocol/hats-zodiac/commit/c0193f51580e23e3136c13f083c991eee60233b1 "add non-zero salt to safe deploy") | Dec 16, 2024 |
| [.gas-snapshot](https://github.com/Hats-Protocol/hats-zodiac/blob/main/.gas-snapshot ".gas-snapshot") | [.gas-snapshot](https://github.com/Hats-Protocol/hats-zodiac/blob/main/.gas-snapshot ".gas-snapshot") | [combine into one implementation](https://github.com/Hats-Protocol/hats-zodiac/commit/09ef274c824638fbb2605b01cee7ca2777059aa3 "combine into one implementation") | Sep 19, 2024 |
| [.gitignore](https://github.com/Hats-Protocol/hats-zodiac/blob/main/.gitignore ".gitignore") | [.gitignore](https://github.com/Hats-Protocol/hats-zodiac/blob/main/.gitignore ".gitignore") | [deploy v1.-beta to optimism](https://github.com/Hats-Protocol/hats-zodiac/commit/62fc12d7c94575c8c71d9cf984ad1aa5c422ad02 "deploy v1.-beta to optimism") | May 8, 2023 |
| [.gitmodules](https://github.com/Hats-Protocol/hats-zodiac/blob/main/.gitmodules ".gitmodules") | [.gitmodules](https://github.com/Hats-Protocol/hats-zodiac/blob/main/.gitmodules ".gitmodules") | [make HSG multicallable](https://github.com/Hats-Protocol/hats-zodiac/commit/df7e7b1dc510071878f2a21c5c1ffa4e71fcca3c "make HSG multicallable") | Oct 25, 2024 |
| [.markdownlintrc](https://github.com/Hats-Protocol/hats-zodiac/blob/main/.markdownlintrc ".markdownlintrc") | [.markdownlintrc](https://github.com/Hats-Protocol/hats-zodiac/blob/main/.markdownlintrc ".markdownlintrc") | [again try fix linting action](https://github.com/Hats-Protocol/hats-zodiac/commit/9738f2a8988f1a362348e35ec29e0630f8c3e714 "again try fix linting action") | Jul 25, 2022 |
| [LICENSE](https://github.com/Hats-Protocol/hats-zodiac/blob/main/LICENSE "LICENSE") | [LICENSE](https://github.com/Hats-Protocol/hats-zodiac/blob/main/LICENSE "LICENSE") | [Update LICENSE](https://github.com/Hats-Protocol/hats-zodiac/commit/90e07da856d3575524a0efe32a4ec91ce337c306 "Update LICENSE") | Nov 18, 2024 |
| [README.md](https://github.com/Hats-Protocol/hats-zodiac/blob/main/README.md "README.md") | [README.md](https://github.com/Hats-Protocol/hats-zodiac/blob/main/README.md "README.md") | [update readme with change since audit](https://github.com/Hats-Protocol/hats-zodiac/commit/b7f1bf98eb459c1078dbf09fbea83e8f68ac800b "update readme with change since audit") | Dec 18, 2024 |
| [example.env](https://github.com/Hats-Protocol/hats-zodiac/blob/main/example.env "example.env") | [example.env](https://github.com/Hats-Protocol/hats-zodiac/blob/main/example.env "example.env") | [deploy v2](https://github.com/Hats-Protocol/hats-zodiac/commit/11428ff318cb111b38e9c53b852132f8e04ab71d "deploy v2") | Dec 18, 2024 |
| [foundry.toml](https://github.com/Hats-Protocol/hats-zodiac/blob/main/foundry.toml "foundry.toml") | [foundry.toml](https://github.com/Hats-Protocol/hats-zodiac/blob/main/foundry.toml "foundry.toml") | [deploy v2](https://github.com/Hats-Protocol/hats-zodiac/commit/11428ff318cb111b38e9c53b852132f8e04ab71d "deploy v2") | Dec 18, 2024 |
| [funding.json](https://github.com/Hats-Protocol/hats-zodiac/blob/main/funding.json "funding.json") | [funding.json](https://github.com/Hats-Protocol/hats-zodiac/blob/main/funding.json "funding.json") | [Create funding.json](https://github.com/Hats-Protocol/hats-zodiac/commit/415456290bf6c9c040f7bf2ce58c7329f87540db "Create funding.json") | May 29, 2024 |
| [gasreport.ansi](https://github.com/Hats-Protocol/hats-zodiac/blob/main/gasreport.ansi "gasreport.ansi") | [gasreport.ansi](https://github.com/Hats-Protocol/hats-zodiac/blob/main/gasreport.ansi "gasreport.ansi") | [gas report and coverage](https://github.com/Hats-Protocol/hats-zodiac/commit/0c4a342cac5cb2326d7e888e97931aa18226f6b4 "gas report and coverage") | Nov 18, 2024 |
| [lcov.info](https://github.com/Hats-Protocol/hats-zodiac/blob/main/lcov.info "lcov.info") | [lcov.info](https://github.com/Hats-Protocol/hats-zodiac/blob/main/lcov.info "lcov.info") | [gas report and coverage](https://github.com/Hats-Protocol/hats-zodiac/commit/0c4a342cac5cb2326d7e888e97931aa18226f6b4 "gas report and coverage") | Nov 18, 2024 |
| View all files |

## Repository files navigation

# Hats Signer Gate

[Permalink: Hats Signer Gate](https://github.com/Hats-Protocol/hats-zodiac#hats-signer-gate)

This repo holds a [Hats Protocol](https://github.com/Hats-Protocol/hats-protocol)-enabled [Zodiac](https://github.com/gnosis/zodiac) contract called Hats Signer Gate (HSG).

## Hats Signer Gate v2

[Permalink: Hats Signer Gate v2](https://github.com/Hats-Protocol/hats-zodiac#hats-signer-gate-v2)

A contract that grants multisig signing rights to addresses wearing a given hats, enabling on-chain organizations (such as DAOs) to revocably delegate to individuals constrained authority and responsibility to operate an account (i.e. a Safe) owned by the organization.

### Overview

[Permalink: Overview](https://github.com/Hats-Protocol/hats-zodiac#overview)

#### Zodiac Module

[Permalink: Zodiac Module](https://github.com/Hats-Protocol/hats-zodiac#zodiac-module)

[HatsSignerGate.sol](https://github.com/Hats-Protocol/hats-zodiac/blob/main/src/HatsSignerGate.sol) is a **Zodiac module** that...

1. Grants multisig signing rights to addresses based on whether they are wearing the appropriate Hat(s).
2. Removes signers who are no long valid (i.e. no longer wearing the signer Hat)
3. Manages the multisig threshold within the [owner](https://github.com/Hats-Protocol/hats-zodiac#contract-ownership)-specified range as new signers are added or removed.

#### Zodiac Guard

[Permalink: Zodiac Guard](https://github.com/Hats-Protocol/hats-zodiac#zodiac-guard)

Since Hat-wearing is dynamic — Hats can be programmatically revoked from wearers — this contract also services as a **Zodiac guard** to ensure that:

A) **Only valid signers can execute transactions**, i.e. only signatures made by accounts currently wearing a valid signer Hat count towards the threshold.

B) **Signers cannot execute transactions that remove the constraint in (A)**. Specifically, this contract guards against signers...

1. Removing the contract as a guard on the multisig
2. Removing the contract as a module on the multisig — or removing/changing/adding any other modules
3. Changing the multisig threshold
4. Changing the multisig owners
5. Making delegatecalls to any target not approved by the owner

> **Warning**
> Protections against (3) and (4) above only hold if the Safe does not have any authority over the signer Hat(s). If it does — e.g. it wears an admin Hat of the signer Hat(s) or is an eligibility or toggle module on the signer Hat(s) — then in some cases the signers may be able to change the multisig threshold or owners.
>
> Proceed with caution if granting such authority to a Safe attached to HatsSignerGate.

### Signer Management

[Permalink: Signer Management](https://github.com/Hats-Protocol/hats-zodiac#signer-management)

Hats Signer Gate provides several ways to manage Safe signers based on their hat-wearing status:

#### Claiming Signer Rights

[Permalink: Claiming Signer Rights](https://github.com/Hats-Protocol/hats-zodiac#claiming-signer-rights)

- Individual hat wearers can claim their own signing rights via `claimSigner()`
- Must be wearing a valid signer hat at time of claim
- Each signer's hat ID is registered and tracked for future validation

#### Claiming for Others

[Permalink: Claiming for Others](https://github.com/Hats-Protocol/hats-zodiac#claiming-for-others)

When enabled by the owner ( `claimableFor = true`):

- Anyone can claim signing rights on behalf of valid hat wearers via `claimSignerFor()` or `claimSignersFor()`
- Useful for batch onboarding of signers
- Prevents re-registration if signer is still wearing their currently registered hat

#### Signer Removal

[Permalink: Signer Removal](https://github.com/Hats-Protocol/hats-zodiac#signer-removal)

- Signers who no longer wear their registered hat can be removed via `removeSigner()`
- Threshold automatically adjusts according to the threshold configuration
- If the removed signer was the last valid signer, the contract itself becomes the sole owner

### Threshold Configuration

[Permalink: Threshold Configuration](https://github.com/Hats-Protocol/hats-zodiac#threshold-configuration)

The threshold (number of required signatures) is managed dynamically based on the `ThresholdConfig`:

#### Threshold Types

[Permalink: Threshold Types](https://github.com/Hats-Protocol/hats-zodiac#threshold-types)

1. **ABSOLUTE**
   - Sets a fixed target number of required signatures
   - Example: Always require exactly 3 signatures
   - Bounded by min threshold and number of valid signers
2. **PROPORTIONAL**
   - Sets a percentage of total signers required (in basis points)
   - Example: Require 51% of signers (5100 basis points)
   - Actual number of required signatures rounds up
   - Still bounded by min threshold

#### Configuration Parameters

[Permalink: Configuration Parameters](https://github.com/Hats-Protocol/hats-zodiac#configuration-parameters)

- `min`: Minimum number of required signatures (must be > 0)
- `target`: Either fixed number (ABSOLUTE) or percentage in basis points (PROPORTIONAL)
- `thresholdType`: ABSOLUTE (0) or PROPORTIONAL (1)

The Safe's threshold is automatically adjusted when:

- New signers are added
- Existing signers are removed
- Threshold configuration is changed

### Delegatecall Targets

[Permalink: Delegatecall Targets](https://github.com/Hats-Protocol/hats-zodiac#delegatecall-targets)

HSG restricts delegatecalls to protect the Safe from unauthorized modifications. Only approved targets can receive delegatecalls.

#### Default Enabled Targets

[Permalink: Default Enabled Targets](https://github.com/Hats-Protocol/hats-zodiac#default-enabled-targets)

The following MultiSend libraries are enabled by default:

| Address | Version | Type |
| --- | --- | --- |
| `0x40A2aCCbd92BCA938b02010E17A5b8929b49130D` | v1.3.0 | canonical |
| `0xA1dabEF33b3B82c7814B6D82A79e50F4AC44102B` | v1.3.0 | eip155 |
| `0x9641d764fc13c8B624c04430C7356C1C7C8102e2` | v1.4.1 | canonical |

See [safe-deployments](https://github.com/safe-global/safe-deployments/tree/main/src/assets) for more information.

#### Security Considerations

[Permalink: Security Considerations](https://github.com/Hats-Protocol/hats-zodiac#security-considerations)

- Delegatecalls can modify Safe state if not properly restricted. Owners should NOT approve delegatecall targets that enable the following:
  - Directly modifying any of the Safe's state, including the Safe's nonce.
  - Additional delegatecalls. For example, the [MultiSend.sol](https://github.com/safe-global/safe-smart-account/blob/v1.4.1-3/contracts/libraries/MultiSend.sol) library that is _not_ "call only" should not be approved. The [MultiSendCallOnly.sol](https://github.com/safe-global/safe-smart-account/blob/v1.4.1-3/contracts/libraries/MultiSendCallOnly.sol) is approved by default.
- HSG validates that approved delegatecalls don't modify critical Safe parameters, but relies on the Safe' nonce to do so.
- Direct calls to the Safe are always prohibited
- When detaching HSG from a Safe — i.e. when calling `detach()` — the owner must trust that admin(s) of the signer Hat(s) will not front-run the detachment to add arbitrary signers. Since admins in Hats Protocol are already trusted (and can be revoked, held accountable, etc.) this is not an additional risk, but HSG owners should nonetheless be aware of this risk.

### Contract Ownership

[Permalink: Contract Ownership](https://github.com/Hats-Protocol/hats-zodiac#contract-ownership)

The wearer of the `ownerHat` can make the following changes to Hats Signer Gate:

01. "Transfer" ownership to a new Hat by changing the `ownerHat`
02. Change the threshold configuration
03. Enable other Zodiac modules on HSG itself
04. Enable another Zodiac guard on HSG itself
05. Add other Hats as valid signer Hats
06. Enable or disable the ability for others to claim signer rights on behalf of valid hat wearers ( `claimableFor`)
07. Detach HatsSignerGate from the Safe (removing it as both guard and module)
08. Migrate to a new HatsSignerGate instance
09. Enable or disable specific delegatecall targets
10. Lock the contract permanently, preventing any further owner changes

### Deploying New Instances

[Permalink: Deploying New Instances](https://github.com/Hats-Protocol/hats-zodiac#deploying-new-instances)

Instances of HSG can be created via the [Zodiac module proxy factory](https://github.com/gnosisguild/zodiac/blob/18b7575bb342424537883f7ebe0a94cd7f3ec4f6/contracts/factory/ModuleProxyFactory.sol).

Instances can be created for an existing Safe by passing the Safe address on initialization, or for a new Safe to be deployed from within HSG's initialization.

### Security Audits

[Permalink: Security Audits](https://github.com/Hats-Protocol/hats-zodiac#security-audits)

#### v1

[Permalink: v1](https://github.com/Hats-Protocol/hats-zodiac#v1)

v1 of this project has received the following security audits. See the [v1 audits directory](https://github.com/Hats-Protocol/hats-zodiac/blob/main/docs/audit-v1) for the detailed reports.

| Auditor | Report Date | Commit Hash | Notes |
| --- | --- | --- | --- |
| Trust Security | Feb 23, 2023 | [b9b7fcf](https://github.com/Hats-Protocol/hats-zodiac/commit/b9b7fcf22fd5cbb98c7d93dead590e80bf9c780a) | Report also includes findings from [Hats Protocol](https://github.com/Hats-Protocol/hats-protocol) audit |
| Sherlock | May 3, 2023 | [9455c0](https://github.com/Hats-Protocol/hats-zodiac/commit/9455cc0957762f5dbbd8e62063d970199109b977) | Report also includes findings from [Hats Protocol](https://github.com/Hats-Protocol/hats-protocol) audit |

#### v2

[Permalink: v2](https://github.com/Hats-Protocol/hats-zodiac#v2)

v2 — the present version — has received the following security audits. See the [v2 audits directory](https://github.com/Hats-Protocol/hats-zodiac/blob/main/docs/audit-v2) for the detailed reports.

| Auditor | Report Date | Commit Hash | Notes |
| --- | --- | --- | --- |
| Sherlock | December 13, 2024 | [a9e3f4f](https://github.com/Hats-Protocol/hats-zodiac/commit/a9e3f4f0e968fb332800a468eddcb993fc6d5cd2) | 166 auditors participated |

> **Note**
> Since this audit was completed, HSG code was updated to add a variable salt to the Safe proxy creation within the `SafeManagerLib.deploySafeAndAttachHSG` function. This ensures that the address of the Safe proxy is unique to the HSG instance.

### Recent Deployments

[Permalink: Recent Deployments](https://github.com/Hats-Protocol/hats-zodiac#recent-deployments)

See [Releases](https://github.com/Hats-Protocol/hats-zodiac/releases) for deployments. Specific deployment parameters are [stored here](https://github.com/Hats-Protocol/hats-zodiac/blob/main/script/DeployParams.json).

## About

Hats Protocol-enabled Zodiac contracts


### Resources

[Readme](https://github.com/Hats-Protocol/hats-zodiac#readme-ov-file)

### License

[LGPL-3.0 license](https://github.com/Hats-Protocol/hats-zodiac#LGPL-3.0-1-ov-file)

[Activity](https://github.com/Hats-Protocol/hats-zodiac/activity)

[Custom properties](https://github.com/Hats-Protocol/hats-zodiac/custom-properties)

### Stars

[**23**\\
stars](https://github.com/Hats-Protocol/hats-zodiac/stargazers)

### Watchers

[**2**\\
watching](https://github.com/Hats-Protocol/hats-zodiac/watchers)

### Forks

[**8**\\
forks](https://github.com/Hats-Protocol/hats-zodiac/forks)

[Report repository](https://github.com/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FHats-Protocol%2Fhats-zodiac&report=Hats-Protocol+%28user%29)

## [Releases\  4](https://github.com/Hats-Protocol/hats-zodiac/releases)

[HatsSignerGate v2\\
Latest\\
\\
Dec 19, 2024](https://github.com/Hats-Protocol/hats-zodiac/releases/tag/v2.0.0)

[\+ 3 releases](https://github.com/Hats-Protocol/hats-zodiac/releases)

## [Packages](https://github.com/orgs/Hats-Protocol/packages?repo_name=hats-zodiac)

No packages published

## [Contributors\  5](https://github.com/Hats-Protocol/hats-zodiac/graphs/contributors)

- [![@spengrah](https://avatars.githubusercontent.com/u/13247381?s=64&v=4)](https://github.com/spengrah)
- [![@nintynick](https://avatars.githubusercontent.com/u/10171948?s=64&v=4)](https://github.com/nintynick)
- [![@gershido](https://avatars.githubusercontent.com/u/81111572?s=64&v=4)](https://github.com/gershido)
- [![@topocount](https://avatars.githubusercontent.com/u/17910833?s=64&v=4)](https://github.com/topocount)
- [![@davehrlichman](https://avatars.githubusercontent.com/u/110009869?s=64&v=4)](https://github.com/davehrlichman)

## Languages

- [Solidity100.0%](https://github.com/Hats-Protocol/hats-zodiac/search?l=solidity)
